"use strict";hui.define("hui_draggable",["hui_util"],function(){hui.Draggable=function(){function t(t,e){for(var o in e)this[o]=e[o];this.elem="string"==typeof t?document.getElementById(t):t,this.onstart=e.start||new Function,this.onmove=e.move||new Function,this.onend=e.end||new Function,this.click=e.click||new Function,this.revert=void 0===e.revert||e.revert?!0:!1,this.action=!1,this.init()}var e="createTouch"in document;t.prototype={startEvent:e?"touchstart":"mousedown",moveEvent:e?"touchmove":"mousemove",endEvent:e?"touchend":"mouseup",preventDefaultEvent:function(t){t?t.preventDefault():window.event.returnValue=!1},getMousePoint:function(t){var o=0,n=0,i=document.documentElement,s=document.body;if(t||(t=window.event),window.pageYoffset?(o=window.pageXOffset,n=window.pageYOffset):(o=(i&&i.scrollLeft||s&&s.scrollLeft||0)-(i&&i.clientLeft||s&&s.clientLeft||0),n=(i&&i.scrollTop||s&&s.scrollTop||0)-(i&&i.clientTop||s&&s.clientTop||0)),e){var r=t.touches.item(0);o=r.pageX,n=r.pageY}else o+=t.clientX,n+=t.clientY;return{x:o,y:n}},getCurrentPosition:function(t){var e=t.currentStyle?t.currentStyle.left:getComputedStyle(t).left,o=t.currentStyle?t.currentStyle.top:getComputedStyle(t).top,n={left:parseInt("0"+e,10),top:parseInt("0"+o,10)};return n},cumulativeOffset:function(t){var e=0,o=0;if(t.parentNode)do e+=t.offsetTop||0,o+=t.offsetLeft||0,t=t.offsetParent;while(t);return{left:o,top:e}},onmousemove:function(){var t=this;t.autoTop===!1||t.zIndex||(t.zIndex=t.elem.style.zIndex),t.elem.style.zIndex=1e3,t.preventDefault||(t.elem.style.left=t.oldPosition.left+(t.nowPoint.x-t.startPoint.x)+"px",t.elem.style.top=t.oldPosition.top+(t.nowPoint.y-t.startPoint.y)+"px"),"undefined"!=typeof hui.Droppables&&hui.Droppables.show&&!t.dropTimer&&(t.dropTimer=window.setTimeout(function(){t.dropTimer=null,hui.Droppables.show(t.nowPoint,t)},50)),t.onmove()},init:function(){var t=this,e=t.elem;e.setAttribute("draggable","true"),t.position=e.currentStyle?e.currentStyle.position:getComputedStyle(e).position,"relative"!=t.position&&"absolute"!=t.position&&(e.style.position="relative"),e["on"+t.startEvent]=t.bind(function(e){if(this.onstart(e)!==!1){if(this.action)return!1;this.action=!0,this.startPoint=this.getMousePoint(e),this.oldPosition=this.getCurrentPosition(this.elem),this.startPosition=this.getCurrentPosition(this.elem),this.oldParentOffset=this.cumulativeOffset(this.elem.parentNode),this.nowPoint=this.getMousePoint(e),this.isMoved=!1,document["on"+this.moveEvent]=this.bind(function(t){this.preventDefaultEvent(t);var e=this;e.isMoving=!0,e.nowPoint=e.getMousePoint(t),e.onmoveTimer||(e.onmoveTimer=window.setTimeout(function(){e.onmoveTimer=null,e.isMoved=!0,e.onmousemove(t)},30))},this),document["on"+this.endEvent]=document.ontouchcancel=this.bind(function(){window.clearTimeout(this.onmoveTimer),this.onmoveTimer=null,document["on"+this.endEvent]=document.ontouchcancel=document["on"+this.moveEvent]=null,t.isMoving=!1,this.autoTop!==!1&&(this.elem.style.zIndex=this.zIndex),this.action=!1,this.isMoved&&this.onend()!==!1&&this.revert&&(this.elem.style.left=this.startPosition.left+"px",this.elem.style.top=this.startPosition.top+"px")},this)}else this.action=!1},t)},bind:function(t,e){return function(){t.apply(e,arguments)}},appendTo:function(t){var e=this;e.oldParentOffset=e.cumulativeOffset(e.elem.parentNode),t.appendChild(e.elem),e.newParentOffset=e.cumulativeOffset(e.elem.parentNode),e.oldPosition.left=e.oldPosition.left+e.oldParentOffset.left-e.newParentOffset.left,e.oldPosition.top=e.oldPosition.top+e.oldParentOffset.top-e.newParentOffset.top,e.onmousemove()}};var o=function(e,n){var i=new t(e,n);return o.drags.push(i),i};return o.drags=[],o}()});