"use strict";hui.define("hui_requester",[],function(){var e={handler:{},createXHRProxyObject:function(){var e=this,t={};return t.xhr=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),t.eventHandlers={},t.fire=e.creatFireHandler(),t.online=/^https?:$/i.test(window.location.protocol),t.responseCallback=function(e,n){window.Requester.updateStatus(n),n&&window.Requester.backendError&&window.Requester.backendError(t,n),n=n||[],e&&window.setTimeout(function(){e(n)},0)},t},creatFireHandler:function(){return function(e){e="on"+e;var t,n=this,r=n.eventHandlers[e],o=window.Requester.handler[e];if(r){if(n.eventHandlers.action&&!n.eventHandlers.action.active)return;if(n.tick&&clearTimeout(n.tick),"onsuccess"!=e)window.setTimeout(function(){r("failure",n)},0);else if("XML"==n.eventHandlers.datatype)try{n.xhr.responseXML,n.responseCallback(r,n.xhr.responseXML)}catch(i){return void window.setTimeout(function(){r("error",n)},0)}else if("TEXT"==n.eventHandlers.datatype)try{n.xhr.responseText,n.responseCallback(r,n.xhr.responseText)}catch(i){return void window.setTimeout(function(){r("error",n)},0)}else{try{n.xhr.responseText}catch(i){return void window.setTimeout(function(){r("error",n)},0)}var s=n.xhr.responseText.replace(/^\s+/gi,"");if(0===s.indexOf("[")){var u;try{u=new Function("return "+s+";"),t=u()}catch(a){u=new Function("return "+window.Requester.removeJSONExtComma(s)+";"),t=u()}n.responseCallback(r,t)}else if(0===s.indexOf("{")){var u;try{u=new Function("return "+s+";"),t=u()}catch(a){u=new Function("return "+window.Requester.removeJSONExtComma(s)+";"),t=u()}n.responseCallback(r,t)}else window.setTimeout(function(){r(null,s)},0)}}else if(o){if("onsuccess"==e)return;o(n)}}},getValidXHR:function(){var e=this;return e.createXHRProxyObject()},request:function(e,t,n){n=n||this.getValidXHR();var r=this.beforeRequest(e,t);if(r&&"string"!=typeof r&&n)n.responseCallback(t.onsuccess,r);else if(r&&"string"==typeof r&&n){e=r;var o,i,s,u=this,a=t||{},c=a.data||"",l=n.online&&a.async!==!1,d=a.username||"",f=a.password||"",p=(a.method||"GET").toUpperCase(),h=a.headers||{},w=a.timeout||0;n.eventHandlers.on404=u.on404,n.eventHandlers.onsuccess=u.onsuccess,n.eventHandlers.ontimeout=u.ontimeout,a.onfailure||(n.eventHandlers.onfailure=window.Requester.fn(u.onfailure,n));for(o in a)a.hasOwnProperty(o)&&(n.eventHandlers[o]=a[o]);n.url=e,h["X-Requested-With"]="XMLHttpRequest",h["Content-Type"]=n.eventHandlers.contentType||n.eventHandlers["Content-Type"]||"application/x-www-form-urlencoded",h.Accept=n.eventHandlers.accept||n.eventHandlers.Accept||"application/x-www-form-urlencoded",h.dataType=n.eventHandlers.dataType=n.eventHandlers.datatype=(a.dataType||"JSON").toLowerCase();try{if("[object Object]"===Object.prototype.toString.call(c)){i=[];for(o in c)o&&c.hasOwnProperty(o)&&i.push(window.Requester.encode(o)+"="+window.Requester.encode(c[o]));c=i.join("&")}c=window.Requester.addSysParam(c),"GET"==p&&c&&(e+=(e.indexOf("?")>=0?"&"==c.substr(0,1)?"":"&":"?")+c,c=null);try{d?n.xhr.open(p,e,l,d,f):n.xhr.open(p,e,l)}catch(g){}s=window.Requester.fn(u.createStateChangeHandler,n),l&&(n.xhr.onreadystatechange=s);for(o in h)h.hasOwnProperty(o)&&n.xhr.setRequestHeader(o,h[o]);n.fire("beforerequest"),w&&(n.tick=setTimeout(function(){n.xhr.onreadystatechange=window.Requester.blank,n.xhr.abort(),delete n.xhr,n.fire("timeout")},w)),n.xhr.send(c),l||s.call(n)}catch(y){n.fire("failure")}}},createStateChangeHandler:function(){var e,t=this;if(4==t.xhr.readyState){try{e=t.xhr.status}catch(n){return void t.fire("failure")}t.fire(e),e>=200&&300>e||304==e||1223==e?(t.status="finished",t.fire("success")):0!==e||t.online?(0===e&&window.console&&window.console.error&&window.console.error("XHR Error: Cross domain, cannot access: %s.",t.url),t.fire("failure")):t.fire("success"),window.Requester.checkQue&&window.setTimeout(window.Requester.checkQue,0)}},encode:function(e,t){e=String(e);var n="%| |&|;|=|+|<|>|,|\"|'|#|/|\\|\n|\r|	".split("|"),r="%25|%20|%26|%3B|%3D|%2B|%3C|%3E|%2C|%22|%27|%23|%2F|%5C|%0A|%0D|%09".split("|");if("decode"==t)for(var o=n.length-1;o>-1;o--)e=e.replace(new RegExp("\\"+r[o],"ig"),n[o]);else for(var o=0,i=n.length;i>o;o++)e=e.replace(new RegExp("\\"+n[o],"ig"),r[o]);return e},decode:function(e){return this.encode(e,"decode")},on404:function(){},onsuccess:function(){},ontimeout:function(){},onfailure:function(){var e=this;hui&&hui.Pnotice&&hui.Pnotice.show&&hui.Pnotice.show('Error: url "'+e.url+'" response '+e.xhr.status,3e3),e.fire("success")}};e.blank=function(){},e.addSysParam=function(e){return e},e.fn=function(e,t){if("[object String]"===Object.prototype.toString.call(e)&&(e=t[e]),"[object Function]"!==Object.prototype.toString.call(e))throw'Error "Requester.fn()": "func" is null';var n=arguments.length>2?[].slice.call(arguments,2):null;return function(){var r="[object String]"==Object.prototype.toString.call(e)?t[e]:e,o=n?n.concat([].slice.call(arguments,0)):arguments;return r.apply(t||r,o)}},e.formatDate=function(e,t){e||(e=new Date),t=t||"yyyy-MM-dd HH:mm";var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours()%12===0?12:e.getHours()%12,"H+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()},r={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(t)&&(t=t.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+r[e.getDay()+""]));for(var o in n)n.hasOwnProperty(o)&&new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[o]:("00"+n[o]).substr((""+n[o]).length)));return t},e.removeJSONExtComma=function(e){var t,n,r,o,i,s,u=null,a=null;for(o=String(e).split(""),t=0,r=o.length;r>t;t++)if(i=o[t],/^[\'\"]$/.test(i)){if(null===u&&null===a){u=!1,a=t;continue}if(u)-1==a?(a=t,u=!1):o[a]===i&&(u=!0,a=-1);else{for(s=0,n=t-1;n>-1;n--)"\\"===o[n]?s++:n=-1;s%2===0&&o[a]===i&&(u=!0,a=-1)}}else if(("]"===i||"}"===i)&&u)for(n=t-1;n>-1;n--)if(!/^[\t\r\n\s ]+$/.test(o[n])){","===o[n]&&(o[n]="");break}return o.join("").replace(/\n/g,"").replace(/\r/g,"")},e.get=function(t,n){return n.method="GET",e.request(t,n)},e.head=function(t,n){return n.method="HEAD",e.request(t,n)},e.post=function(t,n){return n.method="POST",e.request(t,n)},e.postMD5=function(t,n){return n.method="POST",n.usemd5=!0,e.request(t,n)},e.put=function(t,n){return n.method="PUT",e.request(t,n)},e["delete"]=function(t,n){return n.method="DELETE",e.request(t,n)},e.beforeRequest=function(t,n){var r,o=e.getExtClass("hui.Permission"),i=e.getExtClass("hui.Mockup");if(r=o.checkRequest(t,n),r&&"notpermit"==r[0])return null;t=r?r[1]:t;var s=t;return!i.stop&&i.find(t)&&(window.console&&window.console.log&&window.console.log(t),s=hui.Mockup.get(t,n)),s},e.updateStatus=function(){window.hui&&hui.Permission&&hui.Permission.updateStatus},e.backendError=function(e,t){var n;return window.hui&&hui.Action&&hui.Action.get&&(n=hui.Action.get())?(n.showErrorByTree(t),"finished"):void 0},e.jsonproxy={},e.JSONP=function(t,n){var r=e.getExtClass("hui.Mockup"),n=n||{},o=n.onsuccess||Function("");if(!r.stop&&r.find(t))return window.console&&window.console.log&&window.console.log(t),o(r.get(t));var i=this,s=i.getValidProxy(n.action);s.action=n.action,s.onsuccess=n.onsuccess,s.status="send";var u=[];if(n.data)for(var a in n.data)n.data.hasOwnProperty(a)&&u.push(e.encode(a)+"="+e.encode(n.data[a]));u.push("rand="+Math.random()),u.push('callback=window.Requester.jsonproxy_callback("'+s.id+'").callback'),document.getElementById(s.id).src=t+(~t.indexOf("?")?"&":"?")+u.join("&")},e.jsonproxy_callback=function(e){return window.Requester.jsonproxy[e]},e.getValidProxy=function(){var e=this;return e.createProxy()},e.createProxy=function(t){var n=this,r={};r.id=t||e.formatDate(new Date,"yyyyMMddHHmmss")+""+String(Math.random()).substr(3,4),r.status="finished",r.callback=n.creatProxyCallback();var o=document.createElement("script");return o.id=r.id,o.type="text/javascript",o.charset="utf-8",document.getElementsByTagName("head")[0].appendChild(o),o=null,window.Requester.jsonproxy[r.id]=r,r},e.creatProxyCallback=function(){return function(e){var t=this;t.status="finished",t.action&&e&&window.Requester&&window.Requester.backendError&&window.Requester.backendError(t,e),t.onsuccess&&t.onsuccess(e)}},e.getValidProxy=function(){var e,t,n=this,r=null;for(e in n.jsonproxy)if(e&&n.jsonproxy.hasOwnProperty(e)&&n.jsonproxy[e]&&"finished"==n.jsonproxy[e].status){t=document.getElementById(e),t&&window.addEventListener&&(t.parentNode.removeChild(t),r=n.createProxy(e));break}return r||n.createProxy()},e.getExtClass=function(e){var t=function(){};switch(e){case"hui.Permission":"undefined"!=typeof hui&&hui.Permission?t=hui.Permission:(t.checkRequest=new Function,t.set=new Function);break;case"hui.Mockup":"undefined"!=typeof hui&&hui.Mockup?t=hui.Mockup:(t.find=new Function,t.get=new Function)}return t},hui.Mockup={find:function(e){var t=hui.Mockup.maps[e];if(void 0===t){e=e.split("#")[0].split("?")[0];for(var n in hui.Mockup.maps)n.split("#")[0].split("?")[0]===e&&(t=hui.Mockup.maps[n])}return t},get:function(e,t){var n=null,r=hui.Mockup.find(e);return n="[object Function]"===Object.prototype.toString.call(r)?r(e,t):"[object Array]"===Object.prototype.toString.call(r)?"[object Array]"===Object.prototype.toString.call(r[0])?r[(new Date).getTime()%r.length]:r:"[object Object]"===Object.prototype.toString.call(r)?r:"string"!=typeof r?r:r},setRule:function(e,t){hui.Mockup.maps[e]=t},remove:function(e){hui.Mockup.maps[e]=void 0},clear:function(){hui.Mockup.maps={}}},hui.Mockup.maps={},hui.Mockup.setRule("/hui_helloworld",{status:0,message:"",data:"Hello world."}),"undefined"!=typeof window&&(window.Requester=e)});