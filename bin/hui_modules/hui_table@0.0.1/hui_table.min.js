"use strict";hui.define("hui_table",["hui_util","hui_control"],function(){hui.Table=function(t,e){this.isFormItem=!1,hui.Table.superClass.call(this,t,"pending"),this.noDataHtml=this.noDataHtml||"",this.setFields(this.fields),"pending"!=e&&this.enterControl()},hui.Table.prototype={getTplTablePrefix:function(){return'<table cellpadding="0" cellspacing="0" border="0" width="#{0}" control="#{1}">'},onclick:new Function,getMainHtml:function(){var t=this;return hui.Control.format(t.tplTable,t.content||"&nbsp;",t.getClass("label"),t.getId("label"))},render:function(){hui.Table.superClass.prototype.render.call(this);var t=this,e=t.getMain();t._fields&&(t.setSize(),t.isRendered||(t._width=t.getWidth(),t.initColsWidth(),e.style.width=t._width+"px",t.renderHead(),t.renderBody()),t.isRendered=!0)},initColsWidth:function(){var t,e,i,l,o,n=this,r=[],s=n._fields,h=s.length;n.colsWidth=[],e=n._width-h-2;for(var d=0;h>d;d++)i=s[d],o=parseInt(i.width,10),e-=o,n.colsWidth.push(o),i.stable||r.push(d);h=r.length,t=Math.floor(e/h);for(var d=0;h>d;d++)l=Math.abs(e)>Math.abs(t)?t:e,e-=l,n.colsWidth[r[d]]+=l},getWidth:function(){var t,e=this,i=document.createElement("div"),l=e.getMain();return i.innerHTML="&nbsp;",l.appendChild(i),t=i.offsetWidth,l.removeChild(i),t||(t=e.size&&e.size.width?e.size.width:200),t},checkboxField:function(){return{width:30,stable:!0,select:!0,title:function(){return'<input type="checkbox" id="'+this.getId("selectAll")+'" onclick="hui.Control.getById(\''+this.id+"').toggleSelectAll()\" />"},content:function(t,e){return'<input type="checkbox" id="'+this.getId("multiSelect")+e+'" onclick="hui.Control.getById(\''+this.id+"').rowCheckboxClick("+e+')" />'}}},radioboxField:function(){return{width:30,stable:!0,title:"&nbsp;",select:!0,content:function(t,e){var i=this.getId("singleSelect");return'<input type="radio" id="'+i+e+'" name="'+i+'" onclick="hui.Control.getById(\''+this.id+"').selectSingle("+e+');var e=arguments[0]||window.event;if(e.stopPropagation){e.stopPropagation();}else{e.cancelBubble=true;}" />'}}},setFields:function(t){if(t){for(var e=t.slice(0),i=e.length;i--;)e[i]||e.splice(i,1);if(this._fields=e,this.select)switch(String(this.select).toLowerCase()){case"multi":e.unshift(this.checkboxField());break;case"single":e.unshift(this.radioboxField())}}},getBody:function(){return hui.g(this.getId("body"))},getHead:function(){return hui.g(this.getId("head"))},getHeadCheckbox:function(){return hui.g(this.getId("selectAll"))},onselect:function(){},rowCheckboxClick:function(t){"line"!=this.selectMode?this.selectMulti(t):this.preSelectIndex=t},selectMulti:function(t){for(var e,i,l,o=this,n=o.getBody().getElementsByTagName("input"),r=0,s=o,h=n.length,d=o.getHeadCheckbox(),a=[],c=o.getClass("row-selected"),u=o.getId("multiSelect"),g=!t,f=0;h>f;f++)if(e=n[f],i=e.id,"checkbox"==e.getAttribute("type")&&i&&i.indexOf(u)>=0){if(g)for(l=e.parentNode;;){if("DIV"==l.tagName)break;l=l.parentNode}e.checked?(a.push(r),g&&hui.Control.addClass(l,c)):(s=!1,g&&hui.Control.removeClass(l,c)),r++}o.selected=a,o.onselect(a),g||(l=o.getRow(t),e=hui.g(u+t),e.checked?hui.Control.addClass(l,c):hui.Control.removeClass(l,c)),d.checked=s},selectSingle:function(t){var e=this,i=e.getClass("row-selected"),l=e.selected[0];e.onselect(t)!==!1&&("number"==typeof l&&hui.Control.removeClass(e.getRow(l),i),e.selected=[t],hui.Control.addClass(e.getRow(t),i))},toggleSelectAll:function(){this.selectAll(this.getHeadCheckbox().checked)},selectAll:function(t){for(var e,i,l=this.getBody().getElementsByTagName("input"),o=l.length,n=0,r=0,s=[],h=this.getClass("row-selected");o>n;n++)e=l[n],i=e.id,"checkbox"==e.getAttribute("type")&&i&&i.indexOf("multiSelect")>0&&(l[n].checked=t,t?(s.push(r),hui.Control.addClass(this.getRow(r),h)):hui.Control.removeClass(this.getRow(r),h),r++);this.selected=s,this.onselect(s)},getSelected:function(){for(var t=this,e=t.selected,i=t.datasource,l=[],o=0,n=e.length;n>o;o++)l[o]=i[e[o]];return l},renderHead:function(){var t=this,e="head",i=hui.g(t.getId(e));t.noTitle||(i||(i=document.createElement("div"),i.id=t.getId(e),i.className=t.getClass(e),t.getMain().appendChild(i)),i.style.width=t._width-1+"px",i.innerHTML=t.getHeadHtml())},getHeadHtml:function(){function t(t){return a.sortable&&t.sortable?hui.Control.format(' onmouseover="#{0}" onmouseout="#{1}" onclick="#{2}" sortable="1"',"hui.Control.getById('"+a.id+"').titleOverHandler(this)","hui.Control.getById('"+a.id+"').titleOutHandler(this)","hui.Control.getById('"+a.id+"').titleClickHandler(this)"):""}var e,i,l,o,n,r,s,h,d,a=this,c=a._fields,u=c.length,g=[],f=a.getClass("thcntr"),b=a.getClass("thtext"),p=a.getClass("thsort"),C=a.getClass("thsel"),_='<div class="#{0}">#{1}</div>#{2}';for(g.push('<div class="'+a.getClass("row")+'">'),g.push(hui.Control.format(a.getTplTablePrefix(),a._width-2,a.id,a.cellpadding||0,a.cellspacing||0)),g.push("<tr>"),e=0;u>e;e++)i=c[e],l=i.title,s=a.sortable&&i.sortable,d=s&&i.field&&i.field==a.orderBy,r="",n="",s&&(d&&(n=" "+a.getClass("th"+a.order)+" "+a.getClass("thcntr_sort")),r=hui.Control.format(a.getTplSortIcon(),p)),"function"==typeof l?(o=l.call(a),r=""):o=l||"",o=hui.Control.format(_,b,o,r),g.push(hui.Control.format('<th id="#{0}" index="#{1}" #{2} style="width:#{3}px"><div class="#{4}">#{5} #{6}</div></th>',this.getTitleCellId(e),e,t(i,e),a.colsWidth[e],f+n+(i.select?" "+C:""),o,h));return g.push("</tr></table></div>"),g.join("")},getTitleCellId:function(t){return this.getId("titleCell")+t},getTplSortIcon:function(){return'<div class="#{0}"></div>'},tplTipIcon:function(){return'<div class="#{0}" #{1}></div>'},titleOverHandler:function(t){this.sortReady=1,hui.Control.addClass(t.firstChild,this.getClass("thcntr-hover"))},titleOutHandler:function(t){this.sortReady=0,hui.Control.removeClass(t.firstChild,this.getClass("thcntr-hover"))},onsort:function(){},sort:function(t,e){var i,l,o=this;o.datasource.sort(function(o,n){return i=String(o[t]||"").toLowerCase(),l=String(n[t]||"").toLowerCase(),parseInt(i)+parseInt(l)>0&&(i=parseInt(i),l=parseInt(l)),"asc"==e?l>=i:i>=l}),o.sorted=!0},bodyClickHandler:function(){},titleClickHandler:function(t){if(this.sortReady){var e=this,i=e._fields[t.getAttribute("index")].field,l=e.orderBy,o=e.order;o=l==i&&o&&"asc"!=o?"asc":"desc",e.sorted=!1,e.order=o,e.orderBy=i,e.onsort&&e.onsort(i,o),e.sorted||e.sort(i,o),e.renderHead(),e.renderBody()}},resetHeadStyle:function(){for(var t,e=this.getHead().getElementsByTagName("th"),i=e.length;i--;)t=e[i],hui.Control.removeClass(t.firstChild,this.getClass("thcntr_sort"))},renderBody:function(){var t,e=this,i="body",l=e.getId(i),o=hui.g(l);o||(o=document.createElement("div"),o.id=l,o.className=e.getClass(i),e.bodyHeight&&(t=o.style,t.height=e.bodyHeight+"px",t.overflowX="hidden",t.overflowY="auto"),e.getMain().appendChild(o)),o.style.width=e._width-2+"px",o.innerHTML=e.getBodyHtml()},getBodyCellId:function(t,e){return this.getId("cell")+t+"_"+e},getBodyHtml:function(){var t,e,i=this.datasource||[],l=i.length,o=[];if(!l)return this.noDataHtml;for(t=0;l>t;t++)e=i[t],o.push(this.getRowHtml(e,t));return o.join("")},tplRowPrefix:function(){return'<div id="#{0}" class="#{1}" onmouseover="#{2}" onmouseout="#{3}" onclick="#{4}">'},getRowHtml:function(t,e){var i,l,o,n,r,s=this,h=[],d=s._fields,a=d.length,c=s.getClass("tdcntr"),u=s.getClass("tdbreak");h.push(hui.Control.format(s.tplRowPrefix(),s.getId("row")+e,s.getClass("row"),"hui.Control.getById('"+s.id+"').rowOverHandler( "+e+")","hui.Control.getById('"+s.id+"').rowOutHandler(  "+e+")","hui.Control.getById('"+s.id+"').rowClickHandler("+e+")"),hui.Control.format(s.getTplTablePrefix(),s._width-2,s.id));for(var g=0;a>g;g++)r=d[g],l=r.content,i=s.colsWidth[g],o=r.breakLine?u:c,r.select&&(o+=" "+s.getClass("tdsel")),n='<div class="'+o+'">',n+=(r.breakLine?"":"<nobr>")+("function"==typeof l?l.call(s,t,e,g):t[l]),+(r.breakLine?"":"</nobr>")+"</div>",h.push('<td id="'+s.getBodyCellId(e,g)+'"',' style="width:'+i+'px" control="'+s.id,'" row="'+e+'" col="'+g+'">',n,"</td>");return h.push("</tr></table></div>"),h.join("")},rowOverHandler:function(t){var e=this.getRow(t);e&&hui.Control.addClass(e,this.getClass("row-over"))},rowOutHandler:function(t){var e=this.getRow(t);e&&hui.Control.removeClass(e,this.getClass("row-over"))},preventLineSelect:function(){this.dontSelectLine=1},rowClickHandler:function(t){if("line"==this.selectMode){if(this.dontSelectLine)return void(this.dontSelectLine=!1);var e;switch(this.select){case"multi":e=hui.g(this.getId("multiSelect")+t),this.preSelectIndex||(e.checked=!e.checked),this.selectMulti(t),this.preSelectIndex=null;break;case"single":e=hui.g(this.getId("singleSelect")+t),e.checked=!0,this.selectSingle(t)}}this.bodyClickHandler(t)},getRow:function(t){return hui.g(this.getId("row")+t)},dispose:function(){var t=hui.g(this.getId("head"));t&&(t.onmousemove=null,t.onmousedown=null),hui.Table.superClass.dispose.call(this)}},hui.inherits(hui.Table,hui.Control),hui.util.importCssString(".hui_table{}.hui_table_head{}.hui_table_head .hui_table_row{}.hui_table_head .hui_table_row .hui_table_thsel{}.hui_table_head .hui_table_row .hui_table_thcntr{text-align:left;cursor:pointer;}.hui_table_head .hui_table_row .hui_table_thtext{float:left}.hui_table_head .hui_table_row .hui_table_thsort{height:0;width:0;border:10px solid #9c9c9c;border-color:transparent;border-width:10px 5px;float:right;margin-top:-5px;margin-bottom:-10px;margin-right:0px}.hui_table_head .hui_table_thasc  .hui_table_thsort{border-bottom-color:#9c9c9c;border-top:0px;margin-top:10px;display:inline}.hui_table_head .hui_table_thdesc .hui_table_thsort{border-top-color:#9c9c9c;border-bottom:0px;margin-top:10px;display:inline}.hui_table_body{}.hui_table_body .hui_table_row{}.hui_table_body .hui_table_row .hui_table_tdsel{}.hui_table_body .hui_table_row .hui_table_tdcntr{display:inline-block}")});