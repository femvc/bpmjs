"use strict";hui.define("hui_template",["hui"],function(){hui.Template={originTargetContainer:{},parsedTargetContainer:{},targetRule:/<!--\s*target:\s*([a-zA-Z0-9\.\-_]+)\s*-->/g,importRule:/<!--\s*import:\s*([a-zA-Z0-9\.\-_]+)\s*-->/g,parseTemplate:function(e,r){var t,a,n,o,i,p=this;e=e?String(e):"",i=String(Math.random()).replace(".","");for(var l=0;e.indexOf(i)>-1&&1e3>l;l++)i=String(Math.random()).replace(".","");if(e.indexOf(i)>-1)throw new Error({title:"HUI Template Error: ",name:"Math.random()"});if(o={},a=e.match(p.targetRule)||[],n=e.replace(p.targetRule,i).split(i),n.length-a.length==1&&n.shift(),n.length!=a.length)throw new Error({title:"HUI Template Error: ",name:'Methond "parseTemplate()" error.'});for(var l=0,h=a.length;h>l;l++)t=a[l].replace(p.targetRule,"$1"),o[t]=n[l],p.originTargetContainer[t]=n[l];return r!==!0&&p.parseAllTarget(),o},getTarget:function(e){var r=this;if(null===e||""===e)return"";if(void 0===r.parsedTargetContainer[e])throw new Error('Target "'+e+'" not exist.');return r.parsedTargetContainer[e]},parseAllTarget:function(){var e=this,r={};for(var t in e.originTargetContainer)t&&(r[t]=e.originTargetContainer[t]);for(var t in e.originTargetContainer)if(t){var a=e.originTargetContainer[t];for(var n in r)n&&t!=n&&(r[n]=r[n].replace(new RegExp("<!--\\s*import\\s*:\\s*("+t+")\\s*-->","g"),a))}return e.parsedTargetContainer=r,r},merge:function(e,r){return hui.Template.parse(e,r)},format:function(e,r){e=String(e);var t=Array.prototype.slice.call(arguments,1),a=Object.prototype.toString;return t.length?(t=1==t.length&&null!==r&&/\[object (Array|Object)\]/.test(a.call(r))?r:t,e.replace(/#\{(.+?)\}/g,function(e,r){r=String(r).replace(/(^\s+|\s+$)/g,"");var n,o,i,p;if(-1!==r.indexOf("("))p=hui.runWithoutStrict(r,t);else{for(n=hui.Template.overloadOperator(r).split("."),i=t,o=n.shift();o&&i;)i=void 0!==i[o]?i[o]:i=void 0,o=n.shift();p=i}return"[object Function]"===a.call(p)&&(p=p(r)),void 0===p?"":p})):e},error:function(e){if(e="Template: "+e,!hui.window.console)throw Error(e);hui.window.console.log(e)},varConvert:function(e,r,t,a){var n,o,i,p;r=r||{};for(var l=0,h=e.length;h>l;l++)if(n=e[l],","!==n){if(o=n[n.length-1],2===n.length||""===o)throw new Error("Template syntax error: "+n+" in "+a);o=hui.Template.getExpValue(o,r,t);for(var s=0,u=n.length;u-1>s;s++)"="!==n[s]&&(n[s].length>1&&-1!==n[s].indexOf(".")?(p=n[s],p=p.split(".").join("=.=").split("="),i=hui.Template.expCalculate(p,r,t,"keep_var"),i.parent[i.child]=o):r[n[s]]=o)}return r},varTokenization:function(e){var r,t,a,n,o,i=!0,p=-1,l=!1,h=[],s=[],u=[],f=[],g=[],d=[];r=String(e).split("");for(var v=0,c=r.length;c>v;v++)if(t=r[v],/^[\'\"]$/.test(t)){if(i===!0&&-1===p){i=!1,p=v,g.push(t);continue}if(i)-1===p?(i=!1,p=v,g.push(t)):r[p]===t&&(i=!0,p=-1);else{n=0;for(var m=v-1;m>-1;m--)"\\"===r[m]?n++:m=-1;n%2===0?r[p]===t&&(g.push(t),s.push("#{"+d.length+"}"),d.push(g),g=[],i=!0,p=-1):g.push(t)}}else if(i)if("{"===t||"["===t)l=!0,h.push(t),s.push(t);else if("}"===t||"]"===t)h[h.length-1]===("}"===t?"{":"[")&&h.pop(),0===h.length&&(l=!1,s.push(t));else if(l||","!==t)if("="!==t&&"是"!==t||"不"===r[v-1]||"!"===r[v-1]||">"===r[v-1]||"<"===r[v-1]||"="===r[v-1]||"="===r[v+1])if("#"===t&&"{"===r[v+1]){s.push(" ");for(var m=v+2;c>m;m++){if("}"===r[m]){v=m;break}s.push(r[m])}s.push(" ")}else s.push(t);else u.push(s),u.push("="),s=[];else u.push(s),f.push(u),f.push(","),s=[],u=[];else g.push(t);g.join("")&&(s.push("#{"+d.length+"}"),d.push(g)),u.push(s),f.push(u);for(var v=0,c=f.length;c>v;v++)if(o=f[v],"[object Array]"===Object.prototype.toString.call(o))for(var m=0,T=o.length;T>m;m++)"[object Array]"===Object.prototype.toString.call(o[m])&&(o[m]=o[m].join("")),o[m]=String(o[m]).replace(/(^\s+|\s+$)/g,"");for(var v=0,c=d.length;c>v;v++)t=d[v],('"'===t[t.length-1]||"'"===t[t.length-1])&&t.pop(),('"'===t[0]||"'"===t[0])&&t.shift(),d[v]=t.join("");for(var v=0,c=f.length;c>v;v++)if(t=f[v],"[object Array]"===Object.prototype.toString.call(t))for(var m=0,T=t.length;T>m;m++)a=t[m],t[m]=hui.Template.overloadOperator(a);else f[v]=hui.Template.overloadOperator(t);return{token:f,strMap:d}},overloadOperator:function(e){for(var r=["有",".","的",".","自加加","++","自减减","--","非","!","正","+","负","-","乘以","*","除以","/","求余","%","加上","+","减去","-","不大于","<=","不小于",">=","不等于","!=","不是","!==","恒等于","===","真的是","===","不恒等于","!==","大于",">","小于","<","等于","==","且","&&","或","||","实体","{}","数组","[]"],t=0,a=r.length;a>t;)e=e.split(r[t++]).join(r[t++]);return e},getExpValue:function(e,r,t){e=String(e),t=t||[];var a={"null":{v:null},undefined:{v:void 0},"true":{v:!0},"false":{v:!1}},n=e,o=e;if(""===o.replace(/^[+\-]?(\d+\.)?\d+/g,"")||~"\"'".indexOf(o.substr(0,1))||~"{[".indexOf(o.substr(0,1))||a[o]||""===o.replace(/^[a-zA-Z_]+[a-zA-Z0-9_]*/g,""))n=hui.Template.getKeyValue(o);else{var i=hui.Template.expTokenization(o,r),p=hui.Template.expConvertBracket(i,r,t),l=hui.Template.expConvertTree(p,r,t);n=hui.Template.expCalculate(l,r,t)}return n},expCalculate:function(e,r,t,a){if(!e.opr){if(1===e.length)return l="[object Array]"===Object.prototype.toString.call(e[0])?hui.Template.expCalculate(e[0],r,t,a):hui.Template.getKeyValue(e[0],r,t);for(var n=0,o=e.length;o>n;n++)if(hui.Template.expIsOperator(e[n])){e.opr=e[n];break}}var i,p,l,h;if("++"===e.opr||"--"===e.opr){if(i="++"===e[0]||"--"===e[0]?e[1]:e[0],"[object Array]"!==Object.prototype.toString.call(i)&&(!i||""!==i.replace(/^[a-zA-Z_]+[a-zA-Z0-9_]*/g,"")))throw new Error('Syntax error: "++","--" in '+hui.Template.format(e.join(" "),t));i=i.join?hui.Template.expCalculate(i,r,t,"keep_var"):{parent:r,child:i},l=i.parent[i.child],i.parent[i.child]=l+("++"===e.opr?1:-1),l="++"===e[0]||"--"===e[0]?i.parent[i.child]:l}else if("."===e.opr){for(var n=0,o=e.length;o>n;n++)i=e[n],"[object Array]"===Object.prototype.toString.call(i)&&(i=hui.Template.expCalculate(i,r,t)),i&&0===String(i).indexOf("#")&&(i=t[i.replace(/(^#{|}$)/g,"")]),e[n]=i;h=r;for(var o=e.length+("keep_var"===a?-1:0),n=0;o>n&&(i=e[n],h);n++)h=h[i],n++;l="keep_var"===a?{parent:h||{},child:e[e.length-1]}:h}else{for(var n=0,o=e.length;o>n;n++)i=e[n],"[object Array]"===Object.prototype.toString.call(i)?(i=hui.Template.expCalculate(i,r,t),e[n]=i):e[n]=hui.Template.expIsOperator(i)?e[n]:hui.Template.getKeyValue(i,r,t);if("!"===e.opr){l=e.pop();for(var n=e.length-1;n>-1;n--)l=!p}else if("?"===e.opr)i=e[0],l=i?e[2]:e[4];else if("||"===e.opr){l=!1||e[0];for(var n=1,o=e.length;o>n&&!l;n++)i=e[n],"||"!==i||l||(p=e[n+1],l=l||p),n++}else if("&&"===e.opr){l=!0&&e[0];for(var n=1,o=e.length;o>n&&l;n++)i=e[n],"&&"===i&&l&&(p=e[n+1],l=l&&p),n++}else if("!=="===e.opr||"==="===e.opr||"!="===e.opr||"=="===e.opr){l=e[0];for(var n=1,o=e.length;o>n;n++)i=e[n],p=e[n+1],"!=="===i||"!="===i?l=String(l)!==String(p):("==="===i||"=="===i)&&(l=String(l)===String(p)),n++}else if(">"===e.opr||">="===e.opr||"<"===e.opr||"<="===e.opr){l=e[0];for(var n=1,o=e.length;o>n;n++)i=e[n],p=e[n+1],">"===i?l=l>p:">="===i?l=l>=p:"<"===i?l=p>l:"<="===i&&(l=p>=l),n++}else if("+"===e.opr||"-"===e.opr)if("+"===e[0]||"-"===e[0]){l=e.pop();for(var n=e.length-1;n>-1;n--)l="-"===e[n]?0-l:l}else{l=e[0];for(var n=1,o=e.length;o>n;n++)i=e[n],p=e[n+1],"+"===i?l+=p:"-"===i&&(l-=p),n++}else if("*"===e.opr||"/"===e.opr||"%"===e.opr){l=e[0];for(var n=1,o=e.length;o>n;n++)i=e[n],p=e[n+1],"*"===i?l*=p:"/"===i?l/=p:"%"===i&&(l%=p),n++}}return l},getKeyValue:function(e,r,t){e=String(e),t=t||[];var a={"null":{v:null},undefined:{v:void 0},"true":{v:!0},"false":{v:!1}},n=e,o=e;return""===o.replace(/^[+\-]?(\d+\.)?\d+/g,"")?n=Number(o):~"\"'".indexOf(o.substr(0,1))?n=o.replace(/(^[\"\']|[\"\']$)/g,""):~"{[".indexOf(o.substr(0,1))?(o=e.replace(/#{(\d+)}/g,function(e,r){return t[r]}),o=o.replace(/@@/g,"#").replace(/@_/g,"@"),n=new Function("return "+o)(),n=n):n=a[o]?a[o].v:o.indexOf("#")>-1?hui.Template.format(t[o.replace(/(^#{|}$)/g,"")],r):r[o],n},expTokenization:function(e){var r,t,a,n,o=!1,i=[],p=[];r=String(e).split("");for(var l=0,h=r.length;h>l;l++)if(n=r[l],t=","+String(r[l-1])+n+",",a=String(r[l-1])+n+String(r[l+1]),-1!=="[]()+-!*/%<=>&|?:,.".indexOf(n))o=!0,-1!==",++,--,==,!=,>=,<=,&&,||,".indexOf(t)||/\d\.\d/.test(a)?i.push(n):(i.length&&p.push(i),i=[],i.push(n));else if("#"===n){i.length&&p.push(i),i=[];for(var s=l;h>s;s++)if(i.push(r[s]),"}"===r[s]){l=s;break}p.push(i),i=[]}else{if(" "===n||"	"===n)continue;"."===r[l-1]&&-1!=="0123456789".indexOf(n)?i.push(n):(o&&(o=!1,i.length&&p.push(i),i=[]),i.push(n))}i.length&&p.push(i);for(var l=0,h=p.length;h>l;l++)p[l]&&p[l].join&&(p[l]=p[l].join(""));return p},expConvertBracket:function(e){e=e||[];for(var r,t=[],a=null,n=t,o=[t],i=0,p=e.length;p>i;i++)r=e[i],"("===r||"["===r?(a=n,"["===r&&n.push("."),n=[],a.push(n),o.push(n)):o.length>1&&")"===r||"]"===r?(o.pop(),n=a||n,a=o[o.length-2]):n.push(r);return t},expConvertTree:function(e){for(var r=0,t=e.length;t>r;r++)"[object Array]"===Object.prototype.toString.call(e[r])&&(e[r]=hui.Template.expConvertTree(e[r]),r=r);return hui.Template.expBuildTree(e)},expBuildTree:function(e){e=e&&e.length&&e.join?e:[];var r,t,a,n,o,i,p={".":11,"的":11,"[":11,"]":11,"(":10,")":10,"++":9,"自加加":9,"--":9,"自减减":9,"^!":8,"非":8,"^+":8,"正":8,"^-":8,"负":8,"*":7,"乘以":7,"/":7,"除以":7,"%":7,"求余":7,"+":6,"加上":6,"-":6,"减去":6,"<":5,"小于":5,"<=":5,"不大于":5,">":5,"大于":5,">=":5,"不小于":5,"==":4,"等于":4,"!=":4,"不等于":4,"===":4,"恒等于":4,"!==":4,"不恒等于":4,"&&":3,"且":3,"||":2,"或":2};e=e,o=[];for(var l=0,h=e.length;h>l;l++)if(r=e[l],"."===r){if(n=p[r],t=o[o.length-1],!hui.Template.expIsOperand(t)||!hui.Template.expIsOperand(e[l+1]))throw new Error('SyntaxError: invalid Dot(.) operand in "'+e[l-1]+" "+e[l]+" "+e[l+1]+'"');t&&t.lev&&t.lev===n?(t.push(r),t.push(e[l+1]),l++):(t=[],t.push(o.pop()),t.push(r),t.push(e[l+1]),l++,t.lev=n,t.opr=r,o.push(t))}else o.push(r);e=o,o=[];for(var l=0,h=e.length;h>l;l++)if(r=e[l],"++"===r||"--"===r)if(hui.Template.expIsOperand(e[l-1])&&!hui.Template.expIsOperand(e[l+1]))i=[],i.push(o.pop()),i.push(r),i.lev=p[r],i.opr=r,o.push(i);else{if(hui.Template.expIsOperand(e[l-1])||!hui.Template.expIsOperand(e[l+1]))throw new Error('SyntaxError: invalid Increment(++),Decrement(--) operand in "'+e[l-1]+" "+e[l]+" "+e[l+1]+'"');i=[],i.push(r),i.push(e[l+1]),i.lev=p[r],i.opr=r,o.push(i),l++}else o.push(r);e=o,o=[e.pop()];for(var l=e.length-1;l>-1;l--)if(r=e[l],"+"!==r&&"-"!==r&&"!"!==r||!hui.Template.expIsOperator(e[l-1])&&0!==l)o.unshift(r);else{if(n=p["^"+r],t=o[0],!hui.Template.expIsOperand(t))throw new Error('SyntaxError: invalid Negative(+),Positive(-) operand in "'+e[l-1]+" "+e[l]+" "+e[l+1]+'"');t&&t.lev&&t.lev===n?t.unshift(r):(t=[],t.unshift(o.shift()),t.unshift(r),t.lev=n,t.opr=r,o.unshift(t))}e=o,o=[];for(var l=0,h=e.length;h>l;l++)if(r=e[l],"*"===r||"/"===r||"%"===r){if(n=p[r],t=o[o.length-1],!hui.Template.expIsOperand(t)||!hui.Template.expIsOperand(e[l+1]))throw new Error('SyntaxError: invalid MUL(*),DIV(/),(MOD)% operand in "'+e[l-1]+" "+e[l]+" "+e[l+1]+'"');t&&t.lev&&t.lev===n?(t.push(r),t.push(e[l+1]),l++):(t=[],t.push(o.pop()),t.push(r),t.push(e[l+1]),l++,t.lev=n,t.opr=r,o.push(t))}else o.push(r);e=o,o=[];for(var l=0,h=e.length;h>l;l++)if(r=e[l],"+"===r||"-"===r){if(n=p[r],t=o[o.length-1],!hui.Template.expIsOperand(t)||!hui.Template.expIsOperand(e[l+1]))throw new Error('SyntaxError: invalid ADD(+) or SUB(-) operand in "'+e[l-1]+" "+e[l]+" "+e[l+1]+'"');t&&t.lev&&t.lev===n?(t.push(r),t.push(e[l+1]),l++):(t=[],t.push(o.pop()),t.push(r),t.push(e[l+1]),l++,t.lev=n,t.opr=r,o.push(t))}else o.push(r);e=o,o=[];for(var l=0,h=e.length;h>l;l++)if(r=e[l],">"===r||">="===r||"<"===r||"<="===r){if(n=p[r],t=o[o.length-1],!hui.Template.expIsOperand(t)||!hui.Template.expIsOperand(e[l+1]))throw new Error('SyntaxError: invalid Morethan(>,>=),Lessthan(<=,<) operand in "'+e[l-1]+" "+e[l]+" "+e[l+1]+'"');t&&t.lev&&t.lev===n?(t.push(r),t.push(e[l+1]),l++):(t=[],t.push(o.pop()),t.push(r),t.push(e[l+1]),l++,t.lev=n,t.opr=r,o.push(t))}else o.push(r);e=o,o=[];for(var l=0,h=e.length;h>l;l++)if(r=e[l],"=="===r||"!="===r||"==="===r||"!=="===r){if(n=p[r],t=o[o.length-1],!hui.Template.expIsOperand(t)||!hui.Template.expIsOperand(e[l+1]))throw new Error('SyntaxError: invalid Equal(==,!==) operand in "'+e[l-1]+" "+e[l]+" "+e[l+1]+'"');t&&t.lev&&t.lev===n?(t.push(r),t.push(e[l+1]),l++):(t=[],t.push(o.pop()),t.push(r),t.push(e[l+1]),l++,t.lev=n,t.opr=r,o.push(t))}else o.push(r);e=o,o=[];for(var l=0,h=e.length;h>l;l++)if(r=e[l],"&&"===r){if(n=p[r],t=o[o.length-1],!hui.Template.expIsOperand(t)||!hui.Template.expIsOperand(e[l+1]))throw new Error('SyntaxError: invalid AND(&&) operand in "'+e[l-1]+" "+e[l]+" "+e[l+1]+'"');t&&t.lev&&t.lev===n?(t.push(r),t.push(e[l+1]),l++):(t=[],t.push(o.pop()),t.push(r),t.push(e[l+1]),l++,t.lev=n,t.opr=r,o.push(t))}else o.push(r);e=o,o=[];for(var l=0,h=e.length;h>l;l++)if(r=e[l],"||"===r){if(n=p[r],t=o[o.length-1],!hui.Template.expIsOperand(t)||!hui.Template.expIsOperand(e[l+1]))throw new Error('SyntaxError: invalid OR(||) operand in "'+e[l-1]+" "+e[l]+" "+e[l+1]+'"');t&&t.lev&&t.lev===n?(t.push(r),t.push(e[l+1]),l++):(t=[],t.push(o.pop()),t.push(r),t.push(e[l+1]),l++,t.lev=n,t.opr=r,o.push(t))}else o.push(r);e=o,o=[];for(var l=e.length-1;l>-1;l--)if(r=e[l],"?"===r){if(n=p[r],t=e[l-1],!(hui.Template.expIsOperand(t)&&hui.Template.expIsOperand(o[0])&&":"===o[1]&&hui.Template.expIsOperand(o[2])))throw new Error('SyntaxError: invalid "A ? B : C"  operand in "'+e[l-1]+" "+e[l]+" "+e[l+1]+'"');a=[],a.push(t),a.push(r),a.push(o.shift()),a.push(o.shift()),a.push(o.shift()),l--,a.lev=n,a.opr=r,o.unshift(a)}else o.unshift(r);return o},expIsOperator:function(e){e=null===e||void 0===e?"":e,"[object Array]"===Object.prototype.toString.call(e)&&(e=""),e=String(e).replace(/(^\s+|\s+$)/g,"");var r=e.length<4&&-1!=",+,-,*,/,%,&&,||,!,==,===,!=,!==,>,<,>=,<=,.,[,],(,),".indexOf(","+e+",");return r},expIsOperand:function(e){return null!==e&&void 0!==e&&!hui.Template.expIsOperator(e)},startTag:/^<!--\s*([A-Za-z0-9\u4e00-\u9fa5]+):(.*?)-->/,endTag:/^<!--\s*\/([A-Za-z0-9\u4e00-\u9fa5]+)\s*-->/,typeBlock:{"if":1,elif:1,"else":1,"for":1},typeCloseSelf:{"var":1,use:1},typeEndAndStart:{elif:1,"else":1},typeScope:{"for":1,use:1,html:1},parse:function(e,r,t){var a=this,n=a.tokenization(e);if(void 0===t&&(t=hui.Template.createElement("html",{childNodes:[],nodeType:"startTag",labelValue:""}),hui.Template.rootNode=t),r){t.scopeChain=t.scopeChain||{};for(var o in r)r.hasOwnProperty(o)&&(t.scopeChain[o]=r[o])}a.treeConstruction(n,t);for(var i=t,p="",l=[],h=0,s=i.childNodes.length;s>h;h++)l.push(a.mergeModel(i.childNodes[h]));return p=l.join("")},overloadTagName:function(e){var r=["安排","var","定义","var","设定","var","如果","if","如果结束","if","假如","if","假设","if","假设结束","if","又假设","elif","又假如","elif","否则","else","循环","for","循环结束","for"];if(e)for(var t=0,a=r.length;a>t;t++)e.tagName===r[t++]&&(e.tagName=r[t]);return e},tokenization:function(e){for(var r,t,a,n,o,i,p=this,l=[],e=String(e);e;)0===e.indexOf("<!--")&&p.startTag.test(e)?(i=e.match(p.startTag),n={tagName:i[1],nodeValue:i[2],labelValue:i[0],nodeType:"startTag"},n=hui.Template.overloadTagName(n),n.nodeType=p.typeCloseSelf[n.tagName]?"selfClose":p.typeEndAndStart[n.tagName]?"typeEndAndStart":n.nodeType,l.push(n),e=e.substring(i[0].length)):0===e.indexOf("<!--")&&p.endTag.test(e)?(i=e.match(p.endTag),n={tagName:i[1],nodeType:"endTag"},l.push(hui.Template.overloadTagName(n)),e=e.substring(i[0].length)):0===e.indexOf("<!--")?(t=e.indexOf("<!--"),a=e.indexOf("-->",t+4),a=-1==a?e.length:a,o=e.substring(t+4,a),n={tagName:"comment",nodeValue:o,labelValue:o,nodeType:"selfClose"},l.push(hui.Template.overloadTagName(n)),e=e.substring(0,t)+e.substring(a+3,e.length)):(t=e.indexOf("<!--",1),r=-1==t?e.length:t,o=e.substring(0,r),n={tagName:"nodetext",nodeValue:o,labelValue:o,nodeType:"selfClose"},l.push(hui.Template.overloadTagName(n)),e=e.substring(r,e.length));return l},treeConstruction:function(e,r){for(var t,a,n,o=this,i=r||hui.Template.rootNode,p=i,l=0,h=e.length;h>l;l++)if(t=e[l],"selfClose"==t.nodeType)a=o.createElement(t.tagName,t),p.childNodes.push(a),a.parentNode=p;else if("startTag"==t.nodeType)"if"==t.tagName&&(a=o.createElement("ifif",{}),p.childNodes.push(a),a.parentNode=p,a.childNodes=[],p=a),a=o.createElement(t.tagName,t),p.childNodes.push(a),a.parentNode=p,o.typeCloseSelf[t.tagName]||(a.childNodes=[],p=a);else if("endTag"==t.nodeType){if(!o.typeCloseSelf[t.tagName])if(t.tagName==p.tagName)p=p.parentNode;else if("if"==t.tagName&&~",if,elif,else,".indexOf(","+p.tagName))n=p.parentNode,"ifif"==n.tagName&&(p=n.parentNode);else if(o.typeBlock[t.tagName])for(n=p;n;)n.tagName==t.tagName?p=n.parentNode:n=n.parentNode}else"typeEndAndStart"==t.nodeType&&o.typeEndAndStart[t.tagName]&&(~",if,elif,".indexOf(","+p.tagName+",")&&~",elif,else,".indexOf(","+t.tagName)&&(p=p.parentNode),a=o.createElement(t.tagName,t),p.childNodes.push(a),a.parentNode=p,o.typeCloseSelf[t.tagName]||(a.childNodes=[],p=a));return i},createElement:function(e,r){var t=this,a=hui.Template.NodeElement,n=new a;r=r||{},r.tagName=e;for(var o in r)n[o]=r[o];return t.typeScope[String(e).toLowerCase()]&&(n.scopeChain=n.scopeChain||{}),n},mergeModel:function(e){var r,t,a,n,o,i,p,l,h=this;if(e&&e.tagName){var s=String(e.tagName).toLowerCase();if("var"===s)r=e.nodeValue,o=hui.Template.varTokenization(r),l="",p=e.getScopeChainModel(),hui.Template.varConvert(o.token,p,o.strMap,r),e.updateScopeChainModel(p);else if("ifif"===s){p=e.getScopeChainModel(),l="";for(var u=0,f=e.childNodes.length;f>u;u++){if(n=e.childNodes[u],"else"===n.tagName){i=[];for(var g=0,d=n.childNodes.length;d>g;g++)i.push(h.mergeModel(n.childNodes[g]));l=i.join("");break}t=hui.Template.varTokenization(n.nodeValue);var v=hui.Template.getExpValue(t.token[0][0],p,t.strMap);if(v){i=[];for(var g=0,d=n.childNodes.length;d>g;g++)i.push(h.mergeModel(n.childNodes[g]));l=i.join("");break}}}else{if("for"===s){r=e.nodeValue;var c=e.scopeChain;if(p=e.getScopeChainModel(),a=r.split(" in "),t=a[0].replace(/(^\s+|\s+$)/g,"").replace(/(^#{|}$)/g,""),o=p[a[1].replace(/(^\s+|\s+$)/g,"").replace(/(^#{|}$)/g,"")],"[object Array]"!==Object.prototype.toString.call(o))throw new Error('SyntaxError: invalid "list" operand in "'+r+'"');n=e,l="",i=[];for(var u in o){o.hasOwnProperty(u)&&(c[t]=p[t]=o[u]);for(var g=0,d=n.childNodes.length;d>g;g++)i.push(h.mergeModel(n.childNodes[g]))}return l=i.join("")}if("use"===s){r=e.nodeValue.replace(/(^\s+|\s+$)/g,""),p=e.getScopeChainModel(),e.childNodes=[];var m=r.substring(r.indexOf("(")+1,r.lastIndexOf(")")),T=r.substring(0,r.indexOf("(")),x=hui.Template.getTarget(T);h.parse("<!--var:"+m+"-->",null,e),l=h.parse(x,null,e)}else"nodetext"===s?(r=e.nodeValue,p=e.getScopeChainModel(),l=hui.Template.format(r,p)):l=e.labelValue}}return l}},hui.Template.NodeElement=function(){this.nodeValue="",this.guid=hui.Template.NodeElement.makeGUID()},hui.Template.NodeElement.prototype={getGUID:function(){var e=this;return e.guid},getScopeChain:function(){for(var e=this,r=e,t=[],a=hui.Template.typeScope;r;)a[String(r.tagName).toLowerCase()]&&t.unshift(r.scopeChain),r=r.parentNode;return t},getScopeChainModel:function(){for(var e=this,r=e.getScopeChain(),t={},a=r.length-1;a>-1;a--)for(var n in r[a])t.hasOwnProperty(n)||(t[n]=r[a][n]);return t},updateScopeChainModel:function(e){var r=this,t=r.getScopeChain();for(var a in e)if(e.hasOwnProperty(a)){for(var n=t.length-1;n>-1;n--)t[n].hasOwnProperty(a)&&(t[n][a]=e[a],n=-1,a=void 0);void 0!==a&&(t[t.length-1][a]=e[a])}}},hui.Template.NodeElement.makeGUID=function(){var e=1e3;return function(){return String("tpl_"+e++)}}(),hui.format=hui.Template.format});