"use strict";hui.define("hui_validator",["hui_util"],function(){hui.Validator={errorMsg:{SUCCESS:"",ERROR_EMPTY:"不能为空",ERROR_REGEX:"格式错误",ERROR_INT:"格式错误，请输入整数",ERROR_NUMBER:"格式错误，请输入数字",ERROR_MIN:"不能小于#{0}",ERROR_MIN_DATE:"不能早于#{0}",ERROR_MAX:"不能多于#{0}",ERROR_MAX_DATE:"不能晚于#{0}",ERROR_GT:"必须大于#{0}",ERROR_GT_DATE:"必须晚于#{0}",ERROR_LT:"必须少于#{0}",ERROR_LT_DATE:"必须早于#{0}",ERROR_RANGE:"范围须在#{0}与#{1}",ERROR_LENGTH:"长度不等于#{0}",ERROR_MIN_LENGTH:"长度不能小于#{0}",ERROR_MAX_LENGTH:"长度不能大于#{0}",ERROR_LENGTH_RANGE:"长度不能超出范围(#{0}, #{1})",ERROR_CALENDAR:"日历格式错误，正确格式2010-01-01",ERROR_EXT:"扩展名不合法，只允许#{0}",ERROR_BACKEND:" #{0}"},config:{waitingClass:"validate_waiting",okClass:"validate_ok",errorClass:"validate_error",validClass:"validate",iconClass:"validate_icon",textClass:"validate_text",suffix:"validate",iconSuffix:"validateIcon",textSuffix:"validateText"},parse:function(t,e){return"int"===e?parseInt(t,10):"float"===e?parseFloat(t):"date"===e?hui.Validator.parseDate(t):t},setInnerHTML:function(t,e){return t.innerHTML=e,this},getControl:function(t){var e=t&&t.getMain?t.getMain():t&&t.main?hui.Validator.getDocument().getElementById(t.main):t;return e},showError:function(t,e){var a=hui.Validator;a.showNoticeDom(t,e,"errorClass")},showOK:function(t,e){var a=hui.Validator;a.showNoticeDom(t,e,"okClass")},showWaiting:function(t,e){var a=hui.Validator;a.showNoticeDom(t,e,"waitingClass")},showNoticeDom:function(t,e,a){var i=hui.Validator,r=i.getControl(t),o=r.parentNode;i.getValidateElem(r)||i.createNoticeElement(r,o),i.getTextEl(r)&&i.createNoticeTextElem(r),hui.Validator.removeClass(o,i.config.okClass+" "+i.config.errorClass+" "+i.config.waitingClass),hui.Validator.addClass(o,i.config[a]),e=void 0===e?"":e,i.setInnerHTML(i.getTextEl(t),e)},createNoticeElement:function(t,e){var a=hui.Validator,i=t.id,r=a.getValidateElem(t),o=a.getTextEl(t);return r||(r=hui.Validator.getDocument().createElement("div"),r.id=i+"_"+a.config.suffix,r.className=a.config.validClass,e.appendChild(r)),o||a.createNoticeTextElem(t),r},createNoticeTextElem:function(t){var e,a=hui.Validator,i=t.id,r=a.getValidateElem(t),o=a.getTextEl(t);r&&!o&&(e=hui.Validator.getDocument().createElement("div"),e.id=i+"_"+a.config.iconSuffix,e.className=a.config.iconClass,r.appendChild(e),o=hui.Validator.getDocument().createElement("div"),o.id=i+"_"+a.config.textSuffix,o.className=a.config.textClass,r.appendChild(o))},cancelNotice:function(t){var e=hui.Validator,a=e.getControl(t),i=a.parentNode;hui.Validator.removeClass(i,e.config.errorClass+" "+e.config.okClass+" "+e.config.waitingClass),i.lastChild.className&&"validate"===i.lastChild.className.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")&&i.removeChild(i.lastChild)},hideError:function(t){this.cancelNotice(t)},getTextEl:function(t){var e,a=this,i=t,t=a.getControl(i);return e=hui.Validator.getDocument().getElementById(t.id+"_"+a.config.textSuffix)},getValidateElem:function(t){var e,a=this,i=t,t=a.getControl(i);return e=hui.Validator.getDocument().getElementById(t.id+"_"+a.config.suffix)},getSegElement:function(t,e){var a=hui.Validator.getDocument().getElementById(e);return a},applyRule:function(t,e,a){if(!t||!t.getValue&&null===t.value||!e)return!0;var i,r=this,o=e.split(","),n=r.ruleMap[o[0]],l="",u=t.getValue?t.getValue(!0):t.value;if(u=void 0===u?t.getMain().value:u,o[0]=u,"checkbox"==t.type&&(u=t.getChecked()||t.checked,o[0]=u),i=n.validate.apply(t,o),0===i||"SUCCESS"===i||("[object String]"==Object.prototype.toString.call(i)&&""!==i?l=r.errorMsg[i]:"[object Array]"===Object.prototype.toString.call(i)?l=hui.Validator.format(r.errorMsg[i[0]],i.splice(1,i.length)):0!==i&&(l="object"==typeof n.noticeText?n.noticeText[i]:n.noticeText)),"not_show"!==a)if(0===i||"SUCCESS"===i){var s=n.showOK||r.showOK;s(t,l)}else{var R=n.showError||r.showError;R(t,l)}return!l}},hui.Validator.getDocument=function(t){var e=null;return t&&t.getDocument&&(e=t.getDocument()),e=e||document},hui.Validator.format=hui.util.format,hui.Validator.addClass=hui.util.addClass,hui.Validator.removeClass=hui.util.removeClass,hui.Validator.parseDate=hui.util.parseDate,hui.Validator.ruleMap={required:{validate:function(t){return!t||"[object String]"==Object.prototype.toString.call(t)&&""===String(t).replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")?"ERROR_EMPTY":"SUCCESS"}},ext:{validate:function(t){if(""===String(t).replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,""))return"ERROR_EMPTY";var e=Array.prototype.slice.call(arguments,1),a=t.lastIndexOf(".");if(-1==a)return["ERROR_EXT",e.join(",")];for(var i=t.substring(a+1).toLowerCase(),r=0,o=e.length;o>r;r++)if(e[r].toLowerCase()==i)return"SUCCESS";return["ERROR_EXT",e.join(",")]}},regex:{validate:function(t,e,a){return""===String(t).replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")?"SUCCESS":new RegExp(e,a).test(t)?"SUCCESS":"ERROR_REGEX"}},"int":{validate:function(t){return""===String(t).replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")?"SUCCESS":isNaN(t-0)||t.indexOf(".")>=0?"ERROR_INT":"SUCCESS"}},number:{validate:function(t){return""===String(t).replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")?"SUCCESS":isNaN(t-0)?"ERROR_NUMBER":"SUCCESS"}},min:{validate:function(t,e,a){return""===String(t).replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")?"SUCCESS":hui.Validator.parse(t,a)<hui.Validator.parse(e,a)?["date"===a?"ERROR_MIN_DATE":"ERROR_MIN",e]:"SUCCESS"}},gt:{validate:function(t,e,a){return""===String(t).replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")?"SUCCESS":hui.Validator.parse(t,a)<=hui.Validator.parse(e,a)?["date"===a?"ERROR_GT_DATE":"ERROR_GT",e]:"SUCCESS"}},max:{validate:function(t,e,a){return""===String(t).replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")?"SUCCESS":hui.Validator.parse(t,a)>hui.Validator.parse(e,a)?["date"===a?"ERROR_MAX_DATE":"ERROR_MAX",e]:"SUCCESS"}},lt:{validate:function(t,e,a){return""===String(t).replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")?"SUCCESS":hui.Validator.parse(t,a)>=hui.Validator.parse(e,a)?["date"===a?"ERROR_LT_DATE":"ERROR_LT",e]:"SUCCESS"}},range:{validate:function(t,e,a,i){return""===String(t).replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")?"SUCCESS":hui.Validator.parse(t,i)-hui.Validator.parse(a,i)>0||hui.Validator.parse(t,i)-hui.Validator.parse(e,i)<0?["ERROR_RANGE",e,a]:"SUCCESS"}},length:{validate:function(t,e){return t.length!==e?["ERROR_LENGTH",e]:"SUCCESS"}},min_length:{validate:function(t,e){return t.length<e?["ERROR_MIN_LENGTH",e]:"SUCCESS"}},max_length:{validate:function(t,e){return t.length>e?["ERROR_MAX_LENGTH",e]:"SUCCESS"}},length_range:{validate:function(t,e,a){return t.length<e||t.length>a?["ERROR_LENGTH_RANGE",e,a]:"SUCCESS"}},backend_error:{validate:function(t,e){return["ERROR_BACKEND",e.errorMessage]}}},hui.Validator.setRule=function(t,e,a){if(!a&&hui.Validator.ruleMap[t])throw{title:"hui.Validator.setRule() Error: ",name:'rule "'+t+'" exist.'};hui.Validator.ruleMap[t]=e},hui.Validator.getRule=function(t){return hui.Validator.ruleMap[t]},hui.Validator.setRule("not_empty",{validate:function(t){return null===t||void 0===t||""===t?1:0},noticeText:{1:"不能为空"}},"force"),hui.util.importCssString([".validate_error {color: red;}",".validate_error .validate_text {border: 1px solid red;}",".validate_ok {color: #00ff00;}",".validate_waiting {color: blue;}"].join("\n"))});